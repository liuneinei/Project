<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="icon" sizes="any" mask href="images/favicon.ico" />
    <title>即时聊天 - Chat</title>
	<link rel="stylesheet" type="text/css" href="css/socket.css?v1.3" />
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
	<script src="/socket.io/socket.io.js"></script>
</head>
<body>
	<h1>Scoket.IO Chat Demo</h1>
	<div class="wrap chatroom">
		<div class="nickname">
			<form class="set-nickname">
				<label for="nick">输入昵称后进入聊天室</label>
				<di class="chat-tab">
					<input class="nick nick-user" name="nick" type="text" placeholder="昵称" />
				</di>
				<di class="chat-tab">
					<input class="nick nick-pwd" name="pwd" type="password" placeholder="密码" />
				</di>
				<di class="chat-tab">
					<button type="submit">进入</button>
				</di>
				<p class="nickname-err">该昵称已经有人使用</p>
			</form>
		</div>
	</div>
	<script type="text/javascript">
		$(function(){
			var $setNickname = $('.set-nickname'),
					$nickuser = $('.nick-user'),
					$nickpwd = $('.nick-pwd'),
					$nicknameErr = $('.nickname-err');
			var socket = io.connect('http://localhost:8087');

			$setNickname.submit(function(e){
				if ($nickuser.val() == '' && $nickpwd.val() == '') {
					$nickuser.addClass('nick-err');
					$nickpwd.addClass('nick-err');
					return false;
				}else if($nickuser.val() == ''){
					$nickuser.addClass('nick-err');
					$nickpwd.removeClass('nick-err');
					return false;
				}else if($nickpwd.val() == ''){
					$nickuser.removeClass('nick-err');
					$nickpwd.addClass('nick-err');
					return false;
				}else{
					$nickuser.removeClass('nick-err');
					$nickpwd.removeClass('nick-err');
				}
				socket.emit('kefu_user:login', $nickuser.val(), $nickpwd.val(), function(res){
					if(res.result){
						$.cookie('kefu_user_mark',res.sessionId)
						window.location = '/index.html';
						return false;
					}
					$nicknameErr.html(res.message);
					$nicknameErr.css('visibility','visible');
				});
				return false;
			});
		});
	</script>
</body>
</html>